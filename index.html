<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React</title>
  </head>
  <body>
    <div id="root"></div>

    <script type="module" src="/src/main.jsx"></script>

    <!-- Librería con funcionalidad "Sign in with Google" (OAuth 2.0) -->
    <script src="https://accounts.google.com/gsi/client" async></script>

    <!-- Renderizado de botón de Login de Google -->
    <script>
      function handleCredentialResponse(response) {
        const responsePayload = decodeJwtResponse(response.credential);
        const emailDomain = responsePayload.email.split('@')[1];
        if (emailDomain === 'unal.edu.co') {
          window.location.href = '/simulaciones';
        } else {
          const loginError = document.querySelector('.login-error');
          loginError.classList.remove('hidden');
        }
      }

      function decodeJwtResponse(token) {
        let base64Url = token.split('.')[1];
        let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        return JSON.parse(jsonPayload);
      }

      window.onload = function () {
        if (window.location.href === 'http://localhost:5173/') {
          google.accounts.id.initialize({
            client_id: "62094170016-ohbgt13m3tum4upbk7ql3r3mj9fpf5qs.apps.googleusercontent.com",
            callback: handleCredentialResponse
          });
          google.accounts.id.renderButton(
            document.querySelector(".sign-in"),
            { 
              theme: "outline",
              size: "large",
              text: "continue-with",
            }
          );
          google.accounts.id.prompt(); // also display the One Tap dialog
        }
      }
    </script>

    <!-- DEMO: Alternar entre vistas de Estudiante y Admin (CTRL + M) -->
    <script>
      const views = ['/simulaciones', '/admin/asignaturas'];
      let onView = window.location.href === 'http://localhost:5173/admin/asignaturas';

      // Habilitar atajo `Ctrl + M` para alternar vistas (si no se está en la vista Login)
      document.addEventListener('keydown', (ev) => {
        if (ev.ctrlKey && ev.key === 'm' && window.location.href !== 'http://localhost:5173/') {
          onView = 1 - onView;
          window.location.href = views[onView];
        }
      })
    </script>
  </body>
</html>
